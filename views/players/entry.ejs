<% layout('layouts/boilerplate') %>

    <div class="container min-vh-100 d-flex justify-content-center align-items-center">
        <div class="card shadow card-bg w-100" style="max-width: 400px;">
            <div class="card-body card-bg">
                <h5 class="card-title text-center">Player Details</h5>
                <form action="/player/details" method="POST" class="needs-validation" novalidate>
                    <div class="mb-2">
                         <label class="form-label mb-1" for="playerName">Players Name</label>
                         <div class="position-relative">
                            <input class="form-control" type="text" id="playerName" name="playerName" autocomplete="off" required>
                            <input type="hidden" name="playerId" id="playerId">
                            <div id="suggestions" class="dropdown-menu w-100" style="max-height: 200px; overflow-y: auto;"></div>
                         </div>
                    </div>
                    <div class="mb-2">
                        <label class="form-label mb-1" for="playerStat">Stat</label>
                        <select class="form-select" id="playerStat" name="playerStat" required>
                            <option value="" disabled selected>Select Stat</option>
                            <option value="Details">Details</option>
                            <option value="Salary">Salary</option>
                            <option value="Defense">Defense</option>
                            <option value="Offense">Offense</option>
                            <option value="Pitching">Pitching</option>
                        </select>
                    </div>
                    <div class="d-grid">
                        <button class="btn btn-success">Enter</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
<script>
    let debounceTimeout;
    document.getElementById('playerName').addEventListener('input', async function() {
        clearTimeout(debounceTimeout); // Clear previous timeout
        const query = this.value;
        const suggestionsDiv = document.getElementById('suggestions');
        suggestionsDiv.innerHTML = ''; // Clear previous suggestions
        if (query.length < 2) {
            suggestionsDiv.classList.remove('show');
            return; // Only search for queries with 2 or more characters
        }
        debounceTimeout = setTimeout(async () => {
            const res = await fetch(`/player/search?q=${encodeURIComponent(query)}`);
            const players = await res.json();
            suggestionsDiv.innerHTML = ''; // Clear previous suggestions
            if (players.length > 0) {
                suggestionsDiv.classList.add('dropdown-menu', 'show'); // Show suggestions dropdown
                players.forEach(player => {
                    const option = document.createElement('button');
                    option.type = 'button';
                    option.className = 'dropdown-item';
                    option.textContent = player.name_first + ' ' + player.name_last;
                    option.onclick = () => {
                        document.getElementById('playerName').value = player.name_first + ' ' + player.name_last;
                        document.getElementById('playerId').value = player.player_id;
                        suggestionsDiv.innerHTML = ''; // Clear suggestions after selection
                        suggestionsDiv.classList.remove('show'); // Hide suggestions dropdown
                    };
                    suggestionsDiv.appendChild(option);
                });
            } else {
                suggestionsDiv.classList.remove('show'); // Hide if no suggestions
            }
        }, 300); // Debounce for 300ms
    });
</script>
